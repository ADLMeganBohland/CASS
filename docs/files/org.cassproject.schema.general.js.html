<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>org.cassproject.schema.general.js - CASS Javascript Library</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="http://www.cassproject.org/_/rsrc/1451948061999/config/customLogo.gif?revision=16" title="CASS Javascript Library"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.2</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/Action.html">Action</a></li>
                                <li><a href="../classes/AlignmentObject.html">AlignmentObject</a></li>
                                <li><a href="../classes/CreativeWork.html">CreativeWork</a></li>
                                <li><a href="../classes/Ebac.html">Ebac</a></li>
                                <li><a href="../classes/EcAes.html">EcAes</a></li>
                                <li><a href="../classes/EcAesCtr.html">EcAesCtr</a></li>
                                <li><a href="../classes/EcAesCtrAsync.html">EcAesCtrAsync</a></li>
                                <li><a href="../classes/EcArray.html">EcArray</a></li>
                                <li><a href="../classes/EcAsyncHelper.html">EcAsyncHelper</a></li>
                                <li><a href="../classes/EcDirectedGraph.html">EcDirectedGraph</a></li>
                                <li><a href="../classes/EcLinkedData.html">EcLinkedData</a></li>
                                <li><a href="../classes/EcObject.html">EcObject</a></li>
                                <li><a href="../classes/EcPk.html">EcPk</a></li>
                                <li><a href="../classes/EcPpk.html">EcPpk</a></li>
                                <li><a href="../classes/EcRemote.html">EcRemote</a></li>
                                <li><a href="../classes/EcRemoteLinkedData.html">EcRemoteLinkedData</a></li>
                                <li><a href="../classes/EcRsaOaep.html">EcRsaOaep</a></li>
                                <li><a href="../classes/EcRsaOaepAsync.html">EcRsaOaepAsync</a></li>
                                <li><a href="../classes/General.html">General</a></li>
                                <li><a href="../classes/Graph.html">Graph</a></li>
                                <li><a href="../classes/Hypergraph.html">Hypergraph</a></li>
                                <li><a href="../classes/Person.html">Person</a></li>
                                <li><a href="../classes/Triple.html">Triple</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: org.cassproject.schema.general.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/*
 Copyright 2015-2016 Eduworks Corporation and other contributing parties.

 Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may not use this file except in compliance with the License. You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.
*/
/**
 *  Location of strings that store the current namespace for general Eduworks Objects.
 *  @class General
 *  @author fritz.ray@eduworks.com
 */
var General = function() {};
General = stjs.extend(General, null, [], function(constructor, prototype) {
    constructor.context_0_2 = &quot;http://schema.eduworks.com/general/0.2&quot;;
    constructor.context_0_1 = &quot;http://schema.eduworks.com/general/0.1&quot;;
    /**
     *  The latest version of the Eduworks Object namespace.
     *  @property context
     *  @static
     *  @type {string}
     */
    constructor.context = &quot;http://schema.eduworks.com/general/0.2&quot;;
}, {}, {});
/**
 *  Location of strings that store the current namespace for EBAC/KBAC.
 *  @class Ebac
 *  @author fritz.ray@eduworks.com
 */
var Ebac = function() {};
Ebac = stjs.extend(Ebac, null, [], function(constructor, prototype) {
    constructor.context_0_1 = &quot;http://schema.eduworks.com/ebac/0.1&quot;;
    constructor.context_0_2 = &quot;http://schema.eduworks.com/ebac/0.2&quot;;
    constructor.context_0_3 = &quot;http://schema.cassproject.org/kbac/0.2&quot;;
    /**
     *  Current version of KBAC.
     *  @property context
     *  @static
     *  @type string (URL)
     */
    constructor.context = &quot;http://schema.cassproject.org/kbac/0.2&quot;;
}, {}, {});
/**
 *  Data wrapper to represent remotely hosted data. Includes necessary KBAC fields for
 *  permission controls, signing, identifying and locating the object.
 *  
 *  @class EcRemoteLinkedData
 *  @extends EcLinkedData
 *  @author fritz.ray@eduworks.com
 */
var EcRemoteLinkedData = /**
 *  Constructor for remote linked data object.
 *  @constructor
 *  @param {string} context JSON-LD Context.
 *  @param {string} type JSON-LD Type.
 */
function(context, type) {
    EcLinkedData.call(this, context, type);
};
EcRemoteLinkedData = stjs.extend(EcRemoteLinkedData, EcLinkedData, [], function(constructor, prototype) {
    /**
     *  PEM encoded public keys of the owner of the object. A repository, upon
     *  receiving a write operation, will ensure either the data did not
     *  previously exist, or that an owner has provided a signature authorizing
     *  the replacement of the old data with the new data.
     *  @property owner
     *  @type string[] (PEM)
     */
    prototype.owner = null;
    /**
     *  Signatures of the object. The signing method is as follows: Remove the
     *  signature field. Encode the object and its fields in ascii-sort order
     *  JSON-LD using a space-free, tab-free encoding. Sign the aforementioned
     *  string.
     *  @property signature
     *  @type string[] (Base64)
     */
    prototype.signature = null;
    /**
     *  URL/URI used to retrieve, store and identify the object.
     *  @property id
     *  @type string (URL)
     */
    prototype.id = null;
    prototype.privateEncrypted = null;
    /**
     *  PEM encoded public keys of identities authorized to view the object. A
     *  repository will ignore write operations from these identities, but will
     *  allow them to read the object.
     *  @property reader
     *  @type string[] (PEM)
     */
    prototype.reader = null;
    /**
     *  Will generate an identifier using the server URL provided (usually from
     *  an EcRepository).
     *  
     *  @method generateId
     *  @param {string} server Base URL of the server&#x27;s repository functionality.
     */
    prototype.generateId = function(server) {
        this.id = server;
        if (!this.id.endsWith(&quot;/&quot;)) 
            this.id += &quot;/&quot;;
        this.id += &quot;data/&quot;;
        this.id += this.getFullType().replace(&quot;http://&quot;, &quot;&quot;).replaceAll(&quot;/&quot;, &quot;.&quot;);
        this.id += &quot;/&quot;;
        this.id += generateUUID();
        this.id += &quot;/&quot;;
        this.id += new Date().getTime();
    };
    /**
     *  Will generate an identifier using the server URL provided (usually from
     *  an EcRepository) and unique identifier.
     *  
     *  @method assignId
     *  @param {string} server Base URL of the server&#x27;s repository functionality.
     *  @param {string} uniqueIdentifier Canonical identifier. Must contain a letter or symbol.
     */
    prototype.assignId = function(server, uniqueIdentifier) {
        this.id = server;
        if (!this.id.endsWith(&quot;/&quot;)) 
            this.id += &quot;/&quot;;
        this.id += &quot;data/&quot;;
        this.id += this.getFullType().replace(&quot;http://&quot;, &quot;&quot;).replaceAll(&quot;/&quot;, &quot;.&quot;);
        this.id += &quot;/&quot;;
        this.id += uniqueIdentifier;
        this.id += &quot;/&quot;;
        this.id += new Date().getTime();
    };
    /**
     *  Determines if the object has an owner identified by pk. 
     *  Homogenizes the PEM strings for comparison. 
     *  Homogenization is necessary for comparing PKCS#1 and PKCS#8 or PKs with Certificates, etc.
     *  
     *  @method hasOwner
     *  @param {EcPk} pk Public Key of the owner.
     *  @return {boolean} True if owner is represented by the PK, false otherwise.
     */
    prototype.hasOwner = function(pk) {
        if (this.owner == null) 
            return false;
        var pkPem = pk.toPem();
        for (var i = 0; i &lt; this.owner.length; i++) 
            if (pkPem.equals(EcPk.fromPem(this.owner[i]).toPem())) 
                return true;
        return false;
    };
    /**
     *  Determines if the PK matches an owner or if the object is public. 
     *  Homogenizes the PEM strings for comparison. 
     *  Homogenization is necessary for comparing PKCS#1 and PKCS#8 or PKs with Certificates, etc.
     *  
     *  @method canEdit
     *  @param {EcPk} pk Public Key of the owner.
     *  @return {boolean} True if owner is represented by the PK, false otherwise.
     */
    prototype.canEdit = function(pk) {
        if (this.owner == null || this.owner.length == 0) 
            return true;
        return this.hasOwner(pk);
    };
    /**
     *  Encodes the object in a form where it is ready to be signed. 
     *  This method is under long term review, and may change from version to version.
     *  
     *  @method toSignableJson
     *  @return ASCII-sort order encoded space-free and tab-free JSON-LD.
     */
    prototype.toSignableJson = function() {
        var d = JSON.parse(this.toJson());
        if (this.type.contains(&quot;http://schema.eduworks.com/&quot;) &amp;&amp; this.type.contains(&quot;/0.1/&quot;)) {
            delete (d)[&quot;@signature&quot;];
            delete (d)[&quot;@owner&quot;];
            delete (d)[&quot;@reader&quot;];
            delete (d)[&quot;@id&quot;];
            delete (d)[&quot;privateEncrypted&quot;];
        } else {
            delete (d)[&quot;@signature&quot;];
            delete (d)[&quot;@id&quot;];
            delete (d)[&quot;privateEncrypted&quot;];
        }
        var e = new EcLinkedData(d.context, d.type);
        e.copyFrom(d);
        return e.toJson();
    };
    /**
     *  Sign this object using a private key. 
     *  Does not check for ownership, objects signed with keys absent from @owner or @reader may be removed.
     *  
     *  @method signWith
     *  @param {EcPpk} ppk Public private keypair.
     */
    prototype.signWith = function(ppk) {
        var signableJson = this.toSignableJson();
        var signed = EcRsaOaep.sign(ppk, signableJson);
        if (this.signature != null) {
            for (var i = 0; i &lt; this.signature.length; i++) 
                if (this.signature[i].equals(signed)) 
                    return;
        } else {
            this.signature = new Array();
        }
        this.signature.push(signed);
    };
    /**
     *  Verifies the object&#x27;s signatures.
     *  
     *  @method verify
     *  @return {boolean} true if all of the signatures could be verified, false if they could not
     */
    prototype.verify = function() {
        if (this.signature != null) {
            for (var i = 0; i &lt; this.signature.length; ) {
                var works = false;
                var sig = this.signature[i];
                if (this.owner != null) {
                    for (var j = 0; j &lt; this.owner.length; j++) {
                        var own = this.owner[j];
                        var pk = EcPk.fromPem(own);
                        var verify = false;
                        try {
                            verify = EcRsaOaep.verify(pk, this.toSignableJson(), sig);
                        }catch (ex) {}
                        if (verify) {
                            works = true;
                            break;
                        }
                    }
                }
                if (!works) 
                    return false;
                 else 
                    i++;
            }
            if (this.signature.length == 0) 
                return false;
            return true;
        }
        return false;
    };
    /**
     *  Adds an owner to the object, if the owner does not exist.
     *  Note that this method invalidates all signatures.
     *  
     *  @method addOwner
     *  @param {EcPk} newOwner PK of the new owner.
     */
    prototype.addOwner = function(newOwner) {
        var pem = newOwner.toPem();
        if (this.owner == null) 
            this.owner = new Array();
        for (var i = 0; i &lt; this.owner.length; i++) 
            if (this.owner[i].equals(pem)) 
                return;
        this.owner.push(pem);
        this.signature = null;
    };
    /**
     *  Removes an owner from the object, if the owner does exist.
     *  Note that this method invalidates all signatures.
     *  
     *  @method removeOwner
     *  @param {EcPk} oldOwner PK to remove.
     */
    prototype.removeOwner = function(oldOwner) {
        var pem = oldOwner.toPem();
        if (this.owner == null) 
            this.owner = new Array();
        for (var i = 0; i &lt; this.owner.length; i++) 
            if (this.owner[i].equals(pem)) 
                this.owner.splice(i, 1);
        this.signature = null;
    };
    /**
     *  Adds a reader to the object, if the reader does not exist.
     *  Note that this method invalidates all signatures.
     *  
     *  @method addReader
     *  @param {EcPk} newReader PK of the new reader.
     */
    prototype.addReader = function(newReader) {
        var pem = newReader.toPem();
        if (this.reader == null) 
            this.reader = new Array();
        for (var i = 0; i &lt; this.reader.length; i++) 
            if (this.reader[i].equals(pem)) 
                return;
        this.reader.push(pem);
        this.signature = null;
    };
    /**
     *  Removes a reader from the object, if the reader does exist.
     *  Note that this method invalidates all signatures.
     *  
     *  @method removeReader
     *  @param {EcPk} oldReader PK of the old reader.
     */
    prototype.removeReader = function(oldReader) {
        var pem = oldReader.toPem();
        if (this.reader == null) 
            this.reader = new Array();
        for (var i = 0; i &lt; this.reader.length; i++) 
            if (this.reader[i].equals(pem)) 
                this.reader.splice(i, 1);
        this.signature = null;
    };
    /**
     *  Determines if the object is not retrievable from a repository should it be written.
     *  
     *  @method invalid
     *  @return {boolean} True if the object is NOT VALID for storage, false otherwise.
     */
    prototype.invalid = function() {
        if (this.id == null) 
            return true;
        if (this.context == null) 
            return true;
        if (this.getFullType() == null) 
            return true;
        if (this.getFullType().contains(&quot;http://&quot;) == false &amp;&amp; this.getFullType().contains(&quot;https://&quot;) == false) 
            return true;
        return false;
    };
    /**
     *  Updates the ID timestamp of the object, for versioning purposes.
     *  @method updateTimestamp
     */
    prototype.updateTimestamp = function() {
        var rawId = this.id.substring(0, this.id.lastIndexOf(&quot;/&quot;));
        if (rawId.endsWith(&quot;/&quot;) == false) 
            rawId += &quot;/&quot;;
        rawId += new Date().getTime();
        this.id = rawId;
    };
    /**
     *  Returns true if the provided ID represents this object. 
     *  Use this, as version information can make direct comparison difficult.
     *  @method isId
     *  @param {string} id
     *  @return {boolean} True if the provided ID represents this object.
     */
    prototype.isId = function(id) {
        return EcRemoteLinkedData.trimVersionFromUrl(this.id).equals(EcRemoteLinkedData.trimVersionFromUrl(id));
    };
    /**
     *  Removes the version information from an identifier.
     *  Warning: Will remove identifier if the identifier is composed solely of digits!!!
     *  @method trimVersionFromUrl
     *  @static
     *  @param {string} id Slash delimited URL or path.
     *  @return ID without version.
     */
    constructor.trimVersionFromUrl = function(id) {
        if (id == null) 
            return null;
        if (!id.substring(id.lastIndexOf(&quot;/&quot;)).matches(&quot;^\\/[0-9]+$&quot;)) 
            return id;
        var rawId = id.substring(0, id.lastIndexOf(&quot;/&quot;));
        if (rawId.endsWith(&quot;/&quot;)) 
            rawId = rawId.substring(0, rawId.length - 1);
        return rawId;
    };
    /**
     *  Return the ID of this object without the version information. 
     *  Used to reference the latest version of an object.
     *  
     *  @method shortId
     *  @return {string} ID of the latest version of this object.
     */
    prototype.shortId = function() {
        return EcRemoteLinkedData.trimVersionFromUrl(this.id);
    };
    /**
     *  Return a valid ElasticSearch search string that will retrieve all objects with this type.
     *  @method getSearchStringByType
     *  @return {string} ElasticSearch compatible search string.
     */
    prototype.getSearchStringByType = function() {
        var types = this.getTypes();
        var result = &quot;&quot;;
        for (var i = 0; i &lt; types.length; i++) {
            if (i != 0) 
                result += &quot; OR &quot;;
            result += &quot;@type:\&quot;&quot; + types[i] + &quot;\&quot;&quot;;
            var lastSlash = types[i].lastIndexOf(&quot;/&quot;);
            result += &quot; OR (@context:\&quot;&quot; + types[i].substring(0, lastSlash) + &quot;\&quot; AND @type:\&quot;&quot; + types[i].substring(lastSlash + 1) + &quot;\&quot;)&quot;;
        }
        for (var i = 0; i &lt; types.length; i++) {
            if (result.equals(&quot;&quot;) == false) 
                result += &quot; OR &quot;;
            result += &quot;@encryptedType:\&quot;&quot; + types[i] + &quot;\&quot;&quot;;
            var lastSlash = types[i].lastIndexOf(&quot;/&quot;);
            result += &quot; OR (@context:\&quot;&quot; + Ebac.context + &quot;\&quot; AND @encryptedType:\&quot;&quot; + types[i].substring(lastSlash + 1) + &quot;\&quot;)&quot;;
        }
        return &quot;(&quot; + result + &quot;)&quot;;
    };
}, {owner: {name: &quot;Array&quot;, arguments: [null]}, signature: {name: &quot;Array&quot;, arguments: [null]}, reader: {name: &quot;Array&quot;, arguments: [null]}, atProperties: {name: &quot;Array&quot;, arguments: [null]}}, {});

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
